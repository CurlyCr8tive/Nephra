The infinite loop is happening because of how you are redirecting with ConditionalRedirect.

Hereâ€™s why:

When you use <ConditionalRedirect to="/dashboard" /> or <ConditionalRedirect to="/auth" />,

It calls setLocation(to) inside a useEffect.

BUT because the route hasn't yet updated when React re-renders,
your component re-triggers <ConditionalRedirect>, over and over again.

â¡ï¸ Result: setLocation('/dashboard') triggers a rerender â†’ reruns <ConditionalRedirect> â†’ calls setLocation again â†’ infinite loop ğŸ”¥.

ğŸ›  THE SOLUTION:
Instead of using a custom <ConditionalRedirect>,
use the official Redirect component from Wouter directly inside your route.

âœ… Wouter provides a simple <Redirect to="/your-page" />
âœ… It automatically avoids infinite loops.

âœï¸ Hereâ€™s what to change in AppRoutes.tsx:
Instead of:

tsx
Copy
Edit
<Route path="/auth">
  {user ? <ConditionalRedirect to="/dashboard" /> : <AuthPage />}
</Route>
Do:

tsx
Copy
Edit
<Route path="/auth">
  {user ? <Redirect to="/dashboard" /> : <AuthPage />}
</Route>
âœ… SAME for your root / route:

tsx
Copy
Edit
<Route path="/">
  {user ? <Redirect to="/dashboard" /> : <Redirect to="/auth" />}
</Route>
âŒ REMOVE this code:
You can delete your custom ConditionalRedirect component completely.
You don't need it anymore.

ğŸ“‹ Final Corrected AppRoutes.tsx Flow:
tsx
Copy
Edit
import { Switch, Route, Redirect } from "wouter"; // <== Use Redirect from Wouter
import { Toaster } from "@/components/ui/toaster";
import { TooltipProvider } from "@/components/ui/tooltip";
import Dashboard from "@/pages/Dashboard";
import TrackPage from "@/pages/TrackPage";
import AIChatView from "@/pages/AIChatView";
import TransplantRoadmap from "@/pages/TransplantRoadmap";
import MedicalDocuments from "@/pages/MedicalDocuments";
import JournalPage from "@/pages/JournalPage";
import EducationHub from "@/pages/EducationHub";
import ProfilePage from "@/pages/ProfilePage";
import AuthPage from "@/pages/AuthPage";
import NotFound from "@/pages/not-found";
import { AuthProvider } from "@/hooks/useAuth"; 
import ProtectedRoute from "@/components/ProtectedRoute";
import { useUser } from "@/contexts/UserContext"; // <-- this instead of useAuth
import { Loader2 } from "lucide-react"; // if you're showing a loading spinner

const AppRoutes = () => {
  const { user, isLoading } = useUser(); // <-- useUser not useAuth

  if (isLoading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <Loader2 className="h-8 w-8 animate-spin text-primary" />
      </div>
    );
  }

  return (
    <Switch>
      {/* Auth route */}
      <Route path="/auth">
        {user ? <Redirect to="/dashboard" /> : <AuthPage />}
      </Route>

      {/* Root route */}
      <Route path="/">
        {user ? <Redirect to="/dashboard" /> : <Redirect to="/auth" />}
      </Route>

      {/* Protected routes */}
      <Route path="/dashboard">
        <ProtectedRoute>
          <Dashboard />
        </ProtectedRoute>
      </Route>

      <Route path="/log">
        <ProtectedRoute>
          <TrackPage />
        </ProtectedRoute>
      </Route>

      <Route path="/track">
        <ProtectedRoute>
          <TrackPage />
        </ProtectedRoute>
      </Route>

      <Route path="/journal">
        <ProtectedRoute>
          <JournalPage />
        </ProtectedRoute>
      </Route>

      <Route path="/transplant">
        <ProtectedRoute>
          <TransplantRoadmap />
        </ProtectedRoute>
      </Route>

      <Route path="/trends">
        <ProtectedRoute>
          <TrackPage />
        </ProtectedRoute>
      </Route>

      <Route path="/documents">
        <ProtectedRoute>
          <MedicalDocuments />
        </ProtectedRoute>
      </Route>

      <Route path="/education">
        <ProtectedRoute>
          <EducationHub />
        </ProtectedRoute>
      </Route>

      <Route path="/profile">
        <ProtectedRoute>
          <ProfilePage />
        </ProtectedRoute>
      </Route>

      <Route path="/chat">
        <ProtectedRoute>
          <AIChatView />
        </ProtectedRoute>
      </Route>

      {/* Catch all */}
      <Route component={NotFound} />
    </Switch>
  );
};

function App() {
  return (
    <TooltipProvider>
      <AuthProvider>
        <AppRoutes />
        <Toaster />
      </AuthProvider>
    </TooltipProvider>
  );
}

export default App;
ğŸ“¦ What this fixes:

Problem	Solution
ConditionalRedirect useEffect loops infinitely	Redirect from Wouter does immediate safe redirect
Maximum update depth exceeded error	No more infinite rerender
Fragile navigation logic	Stable, clean, automatic redirect handling